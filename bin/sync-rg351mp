#!/usr/bin/env fish

set -l excludes_file (mktemp)

printf "\
homebrew
bios
screenshots
gamedata/dosbox
gamedata/drastic
gamedata/hatari
gamedata/mupen64plussa
gamedata/ppsspp
backup
*.old
.DS_Store
._*
.smbdelete*
" > $excludes_file

if test ! -e /Volumes/Retro
    echo 'Mounting server directory...'
    open -g 'smb://guest:@rpi/Data/Retro'

    while true
        test -e /Volumes/Retro && break
        sleep 1
    end
end

echo 'Syncing...'
rsync -rz --times --itemize-changes --prune-empty-dirs --stats \
    --exclude-from=$excludes_file \
    'rg351mp:roms/*' \
    /Volumes/Retro/roms/
